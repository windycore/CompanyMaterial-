//***************************************************************************
//!file     si_idt_5v9885t.c
//!brief    Audio master clock PLL driver
//
// No part of this work may be reproduced, modified, distributed,
// transmitted, transcribed, or translated into any language or computer
// format, in any form or by any means without written permission of
// Silicon Image, Inc., 1060 East Arques Avenue, Sunnyvale, California 94085
//
// Copyright 2010, Silicon Image, Inc.  All rights reserved.
//***************************************************************************/
#include "string.h"
#undef GPIO_LOCK_KEY

#include "si_common.h"
#include "si_platform.h"
#include "si_i2c.h"
#include "si_audio_dac.h"

#include "si_gpio.h"
#include "si_drv_audio.h"
#include "si_idt_5v9885t.h"


uint8_t  Freq256[SII_AUD_FS_MAX][SII_AUD_FS_SIZE]=
{
	{ //32Khz
		/* 04 */ 0x00,0xFF,0x30,0x00,0x4C,0x4C,0x4C,0x4C,0xC6,0xC6,0xC6,0xC6,
		/* 10 */ 0x01,0x01,0x01,0x01,0x0A,0x0A,0x0A,0x0A,0x31,0x31,0x31,0x31,0x00,0x40,0x00,0x00,
		/* 20 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 30 */ 0x00,0x00,0x00,0x00,0x47,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 40 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xB7,0x10,0x00,
		/* 50 */ 0x00,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x03,0xB8,0x00,0x00,
		/* 60 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	},
	{ //44_1Khz
		/* 04 */ 0x00,0xFF,0x30,0x00,0x4D,0x4D,0x4D,0x4D,0x94,0x94,0x94,0x94,
		/* 10 */ 0x01,0x01,0x01,0x01,0xBE,0xBE,0xBE,0xBE,0x30,0x30,0x30,0x30,0x00,0x40,0x00,0x00,
		/* 20 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 30 */ 0x00,0x00,0x00,0x00,0x47,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 40 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xBB,0x0B,0x00,
		/* 50 */ 0x00,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x03,0xB8,0x00,0x00,
		/* 60 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	},
	{ //48Khz
		/* 04 */ 0x00,0xFF,0x30,0x00,0x4C,0x4C,0x4C,0x4C,0x84,0x84,0x84,0x84,
		/* 10 */ 0x01,0x01,0x01,0x01,0xAE,0xAE,0xAE,0xAE,0x30,0x30,0x30,0x30,0x00,0x40,0x00,0x00,
		/* 20 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 30 */ 0x00,0x00,0x00,0x00,0x47,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 40 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xBB,0x0A,0x00,
		/* 50 */ 0x00,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x03,0xB8,0x00,0x00,
		/* 60 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	},
	{ //88_2Khz
		/* 04 */ 0x00,0xFF,0x30,0x00,0x56,0x56,0x56,0x56,0x94,0x94,0x94,0x94,
		/* 10 */ 0x01,0x01,0x01,0x01,0x5E,0x5E,0x5E,0x5E,0x30,0x30,0x30,0x30,0x00,0x40,0x00,0x00,
		/* 20 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 30 */ 0x00,0x00,0x00,0x00,0x46,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 40 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xBB,0x05,0x00,
		/* 50 */ 0x00,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x03,0xB8,0x00,0x00,
		/* 60 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	},
	{ //96Khz
		/* 04 */ 0x00,0xFF,0x30,0x00,0x56,0x56,0x56,0x56,0x84,0x84,0x84,0x84,
		/* 10 */ 0x01,0x01,0x01,0x01,0x56,0x56,0x56,0x56,0x30,0x30,0x30,0x30,0x00,0x40,0x00,0x04,
		/* 20 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 30 */ 0x00,0x00,0x00,0x00,0x46,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 40 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xB3,0x05,0x04,
		/* 50 */ 0x00,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x03,0xB8,0x00,0x00,
		/* 60 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	},
	{ //176_4Khz

		/* 04 */ 0x00,0xFF,0x30,0x00,0x63,0x63,0x63,0x63,0x94,0x94,0x94,0x94,
		/* 10 */ 0x01,0x01,0x01,0x01,0x2E,0x2E,0x2E,0x2E,0x30,0x30,0x30,0x30,0x00,0x40,0x00,0x00,
		/* 20 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 30 */ 0x00,0x00,0x00,0x00,0x47,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 40 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xBB,0x05,0x00,
		/* 50 */ 0x00,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x03,0xB8,0x00,0x00,
		/* 60 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	},
	{ //192Khz
		/* 04 */ 0x00,0xFF,0x30,0x00,0x63,0x63,0x63,0x63,0x84,0x84,0x84,0x84,
		/* 10 */ 0x01,0x01,0x01,0x01,0x2A,0x2A,0x2A,0x2A,0x30,0x30,0x30,0x30,0x00,0x40,0x00,0x00,
		/* 20 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 30 */ 0x00,0x00,0x00,0x00,0x47,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		/* 40 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xB3,0x05,0x00,
		/* 50 */ 0x00,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x0C,0xB8,0x00,0x00,0x03,0xB8,0x00,0x00,
		/* 60 */ 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	},
};


//------------------------------------------------------------------------------
// Function:    SkI2cIDTWriteBlock
// Description:  Write the data setting to the external PLL chip.
// Parameters:
// Returns:     None
// Note:        
//------------------------------------------------------------------------------

static void IdtI2cWriteBlock (uint8_t regAddr, uint8_t *pWrData, uint16_t nBytes)
{
    SiiPlatformI2cWriteBlock16(0, IDT_PLL_I2C_SADDR, regAddr, pWrData, nBytes);
}


//------------------------------------------------------------------------------
// Function:    SiiPlatformExtnalAudioPllSetting
// Description:  Program the external PLL to generate MCLK based on fs
// Parameters:
// Returns:     None
//------------------------------------------------------------------------------
void SiiPlatformExtnalAudioPllSetting (uint8_t fsType, uint8_t freq)
{
	uint8_t *pFs=0;

	switch (fsType)
	{
		case SII_AUD_MCLK_128:
		case SII_AUD_MCLK_256:
		case SII_AUD_MCLK_384:
		case SII_AUD_MCLK_512:
			pFs = (uint8_t *)Freq256[freq];
			DEBUG_PRINT2(MSG_DBG,"\nAudio 256: Fs -- %d Freq -- %d, Data= 0x%x\n", fsType, freq, *(pFs + 10));
			break;

	}

	IdtI2cWriteBlock(0x04, pFs, SII_AUD_FS_SIZE);
}

